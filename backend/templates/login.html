<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Login - Shader Editor</title>
<style>
body { font-family: system-ui, sans-serif; margin:40px; max-width:480px; }
form { margin-bottom:2rem; padding:1rem; border:1px solid #ccc; border-radius:6px; }
label { display:block; margin:.5rem 0 .25rem; }
input[type=text], input[type=password] { width:100%; padding:.5rem; }
button { padding:.5rem 1rem; cursor:pointer; }
.error { color:#c00; margin-bottom:1rem; }
small { color:#555; }
</style>
</head>
<body>
<h1>Shader Editor Login</h1>
{{if .Error}}<div class="error">{{.Error}}</div>{{end}}
<form method="post" action="/login">
  <h2>Login</h2>
  <label>Username</label>
  <input name="username" required />
  <label>Password</label>
  <input name="password" type="password" required />
  <button type="submit">Login</button>
</form>

<form id="registerForm">
  <h2>Register</h2>
  <label>Username</label>
  <input name="username" required />
  <label>Password</label>
  <input name="password" type="password" required />
  <button type="submit">Create Account</button>
  <div id="regStatus"></div>
  <small>Registration uses the JSON API then you can log in above.</small>
</form>

<script>
const regForm = document.getElementById('registerForm');
regForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(regForm);
  const payload = {username: fd.get('username'), password: fd.get('password')};
  const res = await fetch('/api/register', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  const el = document.getElementById('regStatus');
  if(res.ok){ el.textContent = 'Registered. Please log in.'; el.style.color='green'; }
  else { const j = await res.json().catch(()=>({error:'error'})); el.textContent = j.error || 'Error'; el.style.color='red'; }
});
</script>
</body>
</html>
