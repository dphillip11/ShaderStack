{{ define "Content" }}
<div class="editor-page">
    <div class="editor-header">
        <div class="shader-info">
            <h1 class="shader-title">{{if .Shader.Name}}{{.Shader.Name}}{{else}}New Shader{{end}}</h1>
            {{if .Author}}<p class="shader-author">by {{.Author}}</p>{{end}}
        </div>
        <div class="editor-actions">
            {{if .Shader.ID}}
            <button id="save-shader" class="btn-primary">
                <i class="fas fa-save"></i> Save
            </button>
            {{else}}
            <button id="create-shader" class="btn-primary">
                <i class="fas fa-plus"></i> Create Shader
            </button>
            {{end}}
            <button id="run-shader" class="btn-secondary">
                <i class="fas fa-play"></i> Run
            </button>
        </div>
    </div>

    <div class="editor-container">
        <div class="editor-sidebar">
            {{template "shader_properties.html" .}}
        </div>

        <div class="editor-main">
            <div class="code-tabs">
                {{range $index, $script := .Shader.ShaderScripts}}
                <button class="tab-btn {{if eq $index 0}}active{{end}}" data-target="editor-{{$index}}">
                    Script {{$index}}
                </button>
                {{else}}
                <button class="tab-btn active" data-target="editor-0">
                    Fragment Shader
                </button>
                {{end}}
                <button class="tab-btn add-tab" id="add-script">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div class="code-editors">
                {{range $index, $script := .Shader.ShaderScripts}}
                <textarea id="editor-{{$index}}" class="code-editor {{if eq $index 0}}active{{end}}" data-script-id="{{$script.ID}}">{{$script.Code}}</textarea>
                {{else}}
                <textarea id="editor-0" class="code-editor active" placeholder="@fragment
fn main() -> @location(0) vec4<f32> {
    return vec4<f32>(1.0, 0.0, 0.0, 1.0);
}"></textarea>
                {{end}}
            </div>
        </div>

        <div class="preview-panel">
            <h3>Preview</h3>
            <canvas id="webgpu-canvas" width="400" height="400"></canvas>
            <div id="shader-errors" class="error-panel"></div>
        </div>
    </div>
</div>

<script>
// Pass shader data to JavaScript
window.shaderData = {
    id: {{if .Shader.ID}}{{.Shader.ID}}{{else}}null{{end}},
    name: "{{if .Shader.Name}}{{.Shader.Name}}{{else}}New Shader{{end}}",
    scripts: [
        {{range .Shader.ShaderScripts}}
        {
            id: {{.ID}},
            code: {{.Code | printf "%q"}}
        },
        {{else}}
        {
            id: null,
            code: "@fragment\nfn main() -> @location(0) vec4<f32> {\n    return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n}"
        }
        {{end}}
    ],
    tags: [
        {{range .Shader.Tags}}
        "{{.Name}}",
        {{end}}
    ]
};
</script>
{{ end }}